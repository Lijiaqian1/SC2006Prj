import requests
from datetime import datetime
import json
import math
from bs4 import BeautifulSoup
import re
from geopy.geocoders import GoogleV3
import pickle
geolocator = GoogleV3(api_key='AIzaSyCRa8maOVVWwWRYQ_fyUWD5v_F2BDxqWBU')

locationhtml= '<li class="select2-results__option select2-results__option--selectable" id="select2-vehicle_location_id-ov-result-0iqo-area-4" role="option" data-select2-id="select2-data-select2-vehicle_location_id-ov-result-0iqo-area-4" aria-selected="false">Ang Mo Kio</li><li class="select2-results__option select2-results__option--selectable" id="select2-vehicle_location_id-ov-result-h3ph-area-5" role="option" data-select2-id="select2-data-select2-vehicle_location_id-ov-result-h3ph-area-5" aria-selected="false">Bedok</li><li class="select2-results__option select2-results__option--selectable select2-results__option--highlighted" id="select2-vehicle_location_id-ov-result-xtqk-area-6" role="option" data-select2-id="select2-data-select2-vehicle_location_id-ov-result-xtqk-area-6" aria-selected="true">Bishan</li><li class="select2-results__option select2-results__option--selectable" id="select2-vehicle_location_id-ov-result-pby8-area-7" role="option" data-select2-id="select2-data-select2-vehicle_location_id-ov-result-pby8-area-7" aria-selected="false">Boon Keng</li><li class="select2-results__option select2-results__option--selectable" id="select2-vehicle_location_id-ov-result-kcm7-area-8" role="option" data-select2-id="select2-data-select2-vehicle_location_id-ov-result-kcm7-area-8" aria-selected="false">Braddell</li><li class="select2-results__option select2-results__option--selectable" id="select2-vehicle_location_id-ov-result-4g95-area-9" role="option" data-select2-id="select2-data-select2-vehicle_location_id-ov-result-4g95-area-9" aria-selected="false">Buangkok</li><li class="select2-results__option select2-results__option--selectable" id="select2-vehicle_location_id-ov-result-p896-area-10" role="option" data-select2-id="select2-data-select2-vehicle_location_id-ov-result-p896-area-10" aria-selected="false">Bukit Batok</li><li class="select2-results__option select2-results__option--selectable" id="select2-vehicle_location_id-ov-result-e91m-area-11" role="option" data-select2-id="select2-data-select2-vehicle_location_id-ov-result-e91m-area-11" aria-selected="false">Bukit Panjang</li><li class="select2-results__option select2-results__option--selectable" id="select2-vehicle_location_id-ov-result-z3r8-area-46" role="option" data-select2-id="select2-data-select2-vehicle_location_id-ov-result-z3r8-area-46" aria-selected="false">Canberra</li><li class="select2-results__option select2-results__option--selectable" id="select2-vehicle_location_id-ov-result-fehs-area-1" role="option" data-select2-id="select2-data-select2-vehicle_location_id-ov-result-fehs-area-1" aria-selected="false">Choa Chu Kang</li><li class="select2-results__option select2-results__option--selectable" id="select2-vehicle_location_id-ov-result-bjvi-area-16" role="option" data-select2-id="select2-data-select2-vehicle_location_id-ov-result-bjvi-area-16" aria-selected="false">Clementi</li><li class="select2-results__option select2-results__option--selectable" id="select2-vehicle_location_id-ov-result-3n58-area-17" role="option" data-select2-id="select2-data-select2-vehicle_location_id-ov-result-3n58-area-17" aria-selected="false">Commonwealth</li><li class="select2-results__option select2-results__option--selectable" id="select2-vehicle_location_id-ov-result-bmof-area-40" role="option" data-select2-id="select2-data-select2-vehicle_location_id-ov-result-bmof-area-40" aria-selected="false">Dover / Bouna Vista</li><li class="select2-results__option select2-results__option--selectable" id="select2-vehicle_location_id-ov-result-d2c3-area-18" role="option" data-select2-id="select2-data-select2-vehicle_location_id-ov-result-d2c3-area-18" aria-selected="false">Eunos</li><li class="select2-results__option select2-results__option--selectable" id="select2-vehicle_location_id-ov-result-seej-area-19" role="option" data-select2-id="select2-data-select2-vehicle_location_id-ov-result-seej-area-19" aria-selected="false">Farrer Park</li><li class="select2-results__option select2-results__option--selectable" id="select2-vehicle_location_id-ov-result-vt43-area-20" role="option" data-select2-id="select2-data-select2-vehicle_location_id-ov-result-vt43-area-20" aria-selected="false">Hougang</li><li class="select2-results__option select2-results__option--selectable" id="select2-vehicle_location_id-ov-result-na0r-area-43" role="option" data-select2-id="select2-data-select2-vehicle_location_id-ov-result-na0r-area-43" aria-selected="false">Jurong</li><li class="select2-results__option select2-results__option--selectable" id="select2-vehicle_location_id-ov-result-23q9-area-21" role="option" data-select2-id="select2-data-select2-vehicle_location_id-ov-result-23q9-area-21" aria-selected="false">Jurong East</li><li class="select2-results__option select2-results__option--selectable" id="select2-vehicle_location_id-ov-result-1cga-area-22" role="option" data-select2-id="select2-data-select2-vehicle_location_id-ov-result-1cga-area-22" aria-selected="false">Jurong West</li><li class="select2-results__option select2-results__option--selectable" id="select2-vehicle_location_id-ov-result-amcm-area-23" role="option" data-select2-id="select2-data-select2-vehicle_location_id-ov-result-amcm-area-23" aria-selected="false">Kallang</li><li class="select2-results__option select2-results__option--selectable" id="select2-vehicle_location_id-ov-result-h2yw-area-24" role="option" data-select2-id="select2-data-select2-vehicle_location_id-ov-result-h2yw-area-24" aria-selected="false">MacPherson</li><li class="select2-results__option select2-results__option--selectable" id="select2-vehicle_location_id-ov-result-jylj-area-25" role="option" data-select2-id="select2-data-select2-vehicle_location_id-ov-result-jylj-area-25" aria-selected="false">Marsiling</li><li class="select2-results__option select2-results__option--selectable" id="select2-vehicle_location_id-ov-result-lvaj-area-26" role="option" data-select2-id="select2-data-select2-vehicle_location_id-ov-result-lvaj-area-26" aria-selected="false">Pasir Ris</li><li class="select2-results__option select2-results__option--selectable" id="select2-vehicle_location_id-ov-result-gzq6-area-27" role="option" data-select2-id="select2-data-select2-vehicle_location_id-ov-result-gzq6-area-27" aria-selected="false">Punggol</li><li class="select2-results__option select2-results__option--selectable" id="select2-vehicle_location_id-ov-result-a43n-area-28" role="option" data-select2-id="select2-data-select2-vehicle_location_id-ov-result-a43n-area-28" aria-selected="false">Queenstown</li><li class="select2-results__option select2-results__option--selectable" id="select2-vehicle_location_id-ov-result-rh60-area-29" role="option" data-select2-id="select2-data-select2-vehicle_location_id-ov-result-rh60-area-29" aria-selected="false">Redhill</li><li class="select2-results__option select2-results__option--selectable" id="select2-vehicle_location_id-ov-result-kmva-area-30" role="option" data-select2-id="select2-data-select2-vehicle_location_id-ov-result-kmva-area-30" aria-selected="false">Sembawang</li><li class="select2-results__option select2-results__option--selectable" id="select2-vehicle_location_id-ov-result-dw6g-area-31" role="option" data-select2-id="select2-data-select2-vehicle_location_id-ov-result-dw6g-area-31" aria-selected="false">Sengkang</li><li class="select2-results__option select2-results__option--selectable" id="select2-vehicle_location_id-ov-result-5z1n-area-32" role="option" data-select2-id="select2-data-select2-vehicle_location_id-ov-result-5z1n-area-32" aria-selected="false">Serangoon</li><li class="select2-results__option select2-results__option--selectable" id="select2-vehicle_location_id-ov-result-5uua-area-33" role="option" data-select2-id="select2-data-select2-vehicle_location_id-ov-result-5uua-area-33" aria-selected="false">Simei</li><li class="select2-results__option select2-results__option--selectable" id="select2-vehicle_location_id-ov-result-y6g7-area-34" role="option" data-select2-id="select2-data-select2-vehicle_location_id-ov-result-y6g7-area-34" aria-selected="false">Taman Jurong</li><li class="select2-results__option select2-results__option--selectable" id="select2-vehicle_location_id-ov-result-j1cy-area-35" role="option" data-select2-id="select2-data-select2-vehicle_location_id-ov-result-j1cy-area-35" aria-selected="false">Tampines</li><li class="select2-results__option select2-results__option--selectable" id="select2-vehicle_location_id-ov-result-cmwb-area-36" role="option" data-select2-id="select2-data-select2-vehicle_location_id-ov-result-cmwb-area-36" aria-selected="false">Teck Whye</li><li class="select2-results__option select2-results__option--selectable" id="select2-vehicle_location_id-ov-result-8ske-area-37" role="option" data-select2-id="select2-data-select2-vehicle_location_id-ov-result-8ske-area-37" aria-selected="false">Tiong Bahru</li><li class="select2-results__option select2-results__option--selectable" id="select2-vehicle_location_id-ov-result-emlv-area-38" role="option" data-select2-id="select2-data-select2-vehicle_location_id-ov-result-emlv-area-38" aria-selected="false">Toa Payoh</li><li class="select2-results__option select2-results__option--selectable" id="select2-vehicle_location_id-ov-result-xtu2-area-15" role="option" data-select2-id="select2-data-select2-vehicle_location_id-ov-result-xtu2-area-15" aria-selected="false">Toh Guan</li><li class="select2-results__option select2-results__option--selectable" id="select2-vehicle_location_id-ov-result-l1jn-area-2" role="option" data-select2-id="select2-data-select2-vehicle_location_id-ov-result-l1jn-area-2" aria-selected="false">Wcega Plaza</li><li class="select2-results__option select2-results__option--selectable" id="select2-vehicle_location_id-ov-result-4uzf-area-14" role="option" data-select2-id="select2-data-select2-vehicle_location_id-ov-result-4uzf-area-14" aria-selected="false">Woodlands / Admiralty</li><li class="select2-results__option select2-results__option--selectable" id="select2-vehicle_location_id-ov-result-oogk-area-13" role="option" data-select2-id="select2-data-select2-vehicle_location_id-ov-result-oogk-area-13" aria-selected="false">Yew Tee</li><li class="select2-results__option select2-results__option--selectable" id="select2-vehicle_location_id-ov-result-m9qk-area-12" role="option" data-select2-id="select2-data-select2-vehicle_location_id-ov-result-m9qk-area-12" aria-selected="false">Yishun</li></ul>'
soup = BeautifulSoup(locationhtml, 'html.parser')
locationsname = []
locationsid=[]
for li in soup.find_all('li', {'class': 'select2-results__option--selectable'}):
    location_str = li.text.strip()
    location_id = li.get('id').split('-')[-1]
    if(location_str=='Commonwealth'):
        continue
    if(location_str!='Dover / Bouna Vista'):
        locationsname.append(location_str)
    else:
        locationsname.append('Bouna Vista')
    locationsid.append(location_id)


locationgps={}
for location in locationsname:
    loc= location
    #print(location)
    location = geolocator.geocode(location+" ,Singapore")
    if location is not None:
        locationgps[loc]= (location.latitude, location.longitude, locationsid[locationsname.index(loc)])

with open('carlitelocations.pkl', 'wb') as f:
    pickle.dump(locationgps, f)

with open('carlitelocationsname.pkl', 'wb') as f:
    pickle.dump(locationsname, f)
with open('carlitelocationsidl.pkl', 'wb') as f:
    pickle.dump(locationsid, f)
